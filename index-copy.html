<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>KU Alert</title>

  <link href="https://fonts.googleapis.com/css2?family=Prompt&display=swap" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="styles.css" />

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBDPIi5jATazCUMZ7u-Wa2701z8h8mCM2M",
      authDomain: "ku-alert.firebaseapp.com",
      projectId: "ku-alert",
      storageBucket: "ku-alert.firebasestorage.app",
      messagingSenderId: "619349379112",
      appId: "1:619349379112:web:efa015a517bde9fc86cd1d",
      measurementId: "G-JTQR0511PY"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth();

    window.addEventListener("load", () => {
      onAuthStateChanged(auth, (user) => {
        console.log("AUTH STATE:", user);
        if (user && user.email.endsWith('@ku.th')) {
          const userInfoEl = document.querySelector('.user-info-text');
          console.log("userInfoEl:", userInfoEl);
          if (userInfoEl) {
            const name = user.displayName || user.email.split('@')[0];
            console.log("‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ:", name);
            userInfoEl.textContent = `‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ ${name} (${user.email})`;
          }
        } else {
          console.log("redirecting to login.html...");
          window.location.href = 'login.html';
        }
      });
    });
  </script>
</head>
<body>
  <header class="text-center mb-4"></header>

  <div class="container" role="main" aria-label="‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÅ‡∏à‡πâ‡∏á‡∏ã‡πà‡∏≠‡∏° ‡πÅ‡∏à‡πâ‡∏á‡∏õ‡∏±‡∏ç‡∏´‡∏≤">
    
    <img src="Assets/Logo/KU-AlertLogo-Background-Remove.png" alt="KU-Alert Logo" class="logo"/>
    <h4 class="text-center form-title">‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÅ‡∏à‡πâ‡∏á‡∏ã‡πà‡∏≠‡∏° / ‡πÅ‡∏à‡πâ‡∏á‡∏õ‡∏±‡∏ç‡∏´‡∏≤</h4>

    <div class="progress progress-custom" aria-label="‡πÅ‡∏ñ‡∏ö‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="20">
      <div class="progress-bar progress-bar-custom" id="progressBar" style="width: 20%;"></div>
    </div>

    <div class="user-info-text"></div>
    <button type="button" class="btn btn-logout mb-4" id="logoutBtn">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>

    <form id="repairForm" novalidate>
      <section class="step active" id="step1" aria-label="‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡∏∞‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏õ‡∏±‡∏ç‡∏´‡∏≤">
        <div class="form-group">
          <label for="department" class="form-label">‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô / ‡∏Ñ‡∏ì‡∏∞</label>
          <select id="department" class="form-select" required aria-required="true">
            <option value="" disabled selected>-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å --</option>
            <option value="‡∏Ñ‡∏ì‡∏∞‡∏ß‡∏¥‡∏®‡∏ß‡∏Å‡∏£‡∏£‡∏°‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå">‡∏Ñ‡∏ì‡∏∞‡∏ß‡∏¥‡∏®‡∏ß‡∏Å‡∏£‡∏£‡∏°‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå</option>
            <option value="‡∏Ñ‡∏ì‡∏∞‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå">‡∏Ñ‡∏ì‡∏∞‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå</option>
            <option value="‡∏™‡∏≥‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà">‡∏™‡∏≥‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà</option>
          </select>
          <div class="invalid-feedback">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô</div>
        </div>

        <div class="form-group">
          <label for="problemType" class="form-label">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏õ‡∏±‡∏ç‡∏´‡∏≤</label>
          <select id="problemType" class="form-select" required aria-required="true">
            <option value="" disabled selected>-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å --</option>
            <option value="‡πÑ‡∏ü‡∏ü‡πâ‡∏≤">‡πÑ‡∏ü‡∏ü‡πâ‡∏≤</option>
            <option value="‡∏õ‡∏£‡∏∞‡∏õ‡∏≤">‡∏õ‡∏£‡∏∞‡∏õ‡∏≤</option>
            <option value="‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå / ‡πÄ‡∏Ñ‡∏£‡∏∑‡∏≠‡∏Ç‡πà‡∏≤‡∏¢">‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå / ‡πÄ‡∏Ñ‡∏£‡∏∑‡∏≠‡∏Ç‡πà‡∏≤‡∏¢</option>
            <option value="‡∏≠‡∏∑‡πà‡∏ô ‡πÜ">‡∏≠‡∏∑‡πà‡∏ô ‡πÜ</option>
          </select>
          <div class="invalid-feedback">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏õ‡∏±‡∏ç‡∏´‡∏≤</div>
        </div>

        <div class="form-navigation">
          <button type="button" class="btn btn-action w-100" id="nextBtn1">‡∏ñ‡∏±‡∏î‡πÑ‡∏õ ‚Üí</button>
        </div>
      </section>

      <section class="step" id="step2" aria-label="‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö">
        <div class="form-group">
          <label for="imageInput" class="form-label">‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ (1‚Äì10 ‡∏£‡∏π‡∏õ)</label>
          <input type="file" id="imageInput" class="form-control" accept="image/*" multiple required aria-required="true" />
          <div class="invalid-feedback">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏£‡∏π‡∏õ ‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 10 ‡∏£‡∏π‡∏õ</div>
        </div>
        
        <div id="imagePreview" class="image-preview-container" aria-live="polite" aria-atomic="true"></div>

        <div class="form-navigation">
          <button type="button" class="btn btn-secondary" id="prevBtn2">‚Üê ‡∏Å‡∏•‡∏±‡∏ö</button>
          <button type="button" class="btn btn-action" id="nextBtn2">‡∏ñ‡∏±‡∏î‡πÑ‡∏õ ‚Üí</button>
        </div>
      </section>

      <section class="step" id="step3" aria-label="‡∏Å‡∏£‡∏≠‡∏Å‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡πÅ‡∏•‡∏∞‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î">
        <div class="form-group">
          <label for="subject" class="form-label">‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠</label>
          <input type="text" id="subject" class="form-control" required aria-required="true" />
          <div class="invalid-feedback">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠</div>
        </div>

        <div class="form-group">
          <label for="details" class="form-label">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</label>
          <textarea id="details" class="form-control" rows="4" required aria-required="true"></textarea>
          <div class="invalid-feedback">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</div>
        </div>

        <div class="form-navigation">
          <button type="button" class="btn btn-secondary" id="prevBtn3">‚Üê ‡∏Å‡∏•‡∏±‡∏ö</button>
          <button type="button" class="btn btn-action" id="nextBtn3">‡∏ñ‡∏±‡∏î‡πÑ‡∏õ ‚Üí</button>
        </div>
      </section>

      <section class="step" id="step4" aria-label="‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡πâ‡∏≤‡∏¢‡πÅ‡∏£‡∏á">
        <div class="form-group">
          <label for="severity" class="form-label">‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡πâ‡∏≤‡∏¢‡πÅ‡∏£‡∏á</label>
          <select id="severity" class="form-select" required aria-required="true">
            <option value="" disabled selected>-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å --</option>
            <option value="‡∏°‡∏≤‡∏Å‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î (‡∏î‡πà‡∏ß‡∏ô‡∏°‡∏≤‡∏Å)">‡∏°‡∏≤‡∏Å‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î (‡∏î‡πà‡∏ß‡∏ô‡∏°‡∏≤‡∏Å)</option>
            <option value="‡∏°‡∏≤‡∏Å">‡∏°‡∏≤‡∏Å</option>
            <option value="‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á">‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á</option>
            <option value="‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢ / ‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á">‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢ / ‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á</option>
          </select>
          <div class="invalid-feedback">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡πâ‡∏≤‡∏¢‡πÅ‡∏£‡∏á</div>
        </div>

        <div class="form-navigation">
          <button type="button" class="btn btn-secondary" id="prevBtn4">‚Üê ‡∏Å‡∏•‡∏±‡∏ö</button>
          <button type="button" class="btn btn-action" id="previewBtn">‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡πà‡∏≠‡∏ô‡∏™‡πà‡∏á</button>
        </div>
      </section>

      <section class="step" id="step5" aria-label="‡∏™‡∏£‡∏∏‡∏õ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡πà‡∏≠‡∏ô‡∏™‡πà‡∏á">
        <h4 class="text-center preview-title">üîé ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡πà‡∏≠‡∏ô‡∏™‡πà‡∏á</h4>

        <div class="preview-box" aria-live="polite" aria-atomic="true">
          <div class="preview-item">
            <strong>‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô:</strong> <span id="previewDepartment"></span>
          </div>
          <div class="preview-item">
            <strong>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏õ‡∏±‡∏ç‡∏´‡∏≤:</strong> <span id="previewProblemType"></span>
          </div>
          <div class="preview-item">
            <strong>‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠:</strong> <span id="previewSubject"></span>
          </div>
          <div class="preview-item">
            <strong>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î:</strong> <span id="previewDetails"></span>
          </div>
          <div class="preview-item">
            <strong>‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡πâ‡∏≤‡∏¢‡πÅ‡∏£‡∏á:</strong> <span id="previewSeverity"></span>
          </div>
          <div class="preview-item">
            <strong>‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û:</strong>
            <div id="previewImages" class="preview-images"></div>
          </div>
        </div>

        <div class="form-navigation">
          <button type="button" class="btn btn-secondary" id="prevBtn5">‚Üê ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
          <button type="submit" class="btn btn-action">‚úÖ ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
        </div>
      </section>
    </form>
  </div>

  <div class="modal fade" id="submitModal" tabindex="-1" aria-labelledby="submitModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content modal-custom">
        <div class="modal-header modal-header-success">
          <h5 class="modal-title mx-auto" id="submitModalLabel">üéâ ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à</h5>
        </div>
        <div class="modal-body modal-body-custom">
          ‡∏£‡∏∞‡∏ö‡∏ö‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏•‡πâ‡∏ß<br />
          ‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡πÉ‡∏ô‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏ñ‡∏±‡∏î‡πÑ‡∏õ üôè
        </div>
        <div class="modal-footer modal-footer-custom">
          <button type="button" class="btn btn-success btn-action px-5" data-bs-dismiss="modal">‡∏ï‡∏Å‡∏•‡∏á</button>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="imageZoomModal" tabindex="-1" aria-labelledby="imageZoomLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg">
      <div class="modal-content modal-custom">
        <div class="modal-header">
          <h5 class="modal-title" id="imageZoomLabel">‡∏î‡∏π‡∏†‡∏≤‡∏û‡∏Ç‡∏¢‡∏≤‡∏¢</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="‡∏õ‡∏¥‡∏î"></button>
        </div>
        <div class="modal-body text-center">
          <img src="" alt="‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏Ç‡∏¢‡∏≤‡∏¢" id="zoomedImage" class="modal-img" />
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="script.js"></script>
</body>
</html>